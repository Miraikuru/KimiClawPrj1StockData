# Agent Swarm 每日新闻简报工作流程

**版本**: v1.0  
**创建日期**: 2026年2月17日  
**最后更新**: 2026年2月17日

---

## 🎯 概述

使用多Agent协作模式完成每日新闻简报的收集、整理、生成和推送工作。

---

## 📋 Agent 分工表

| 序号 | Agent名称 | 职责 | 输出 |
|:---:|-----------|------|------|
| 1 | **Template Agent** | 维护HTML模板 | 标准化的HTML模板文件 |
| 2 | **Data Agent** | 获取汇率和金价数据 | 实时汇率、金价数据 |
| 3 | **News Agent** | 财经新闻爬取+事实核查 | 经核查的财经新闻列表 |
| 4 | **Twitter Agent** | 推特Trend爬取 | 美国、日本Trend列表 |
| 5 | **HotSearch Agent** | 新浪/百度热搜爬取 | 热搜榜单 |
| 6 | **Gaming Agent** | 游戏新闻收集 | PC+手游新闻 |
| 7 | **Music Agent** | 每日一曲推荐 | 歌曲信息+背景 |
| 8 | **Vocab Agent** | 行业词汇整理 | 5个高阶词汇 |
| 9 | **Integrator Agent** | 整合填充模板 | 完整的HTML文件 |
| 10 | **GitHub Agent** | 上传到GitHub | 仓库更新 |
| 11 | **Feishu Agent** | 推送到飞书 | 用户通知 |

---

## 🔄 工作流程图

```
┌─────────────────────────────────────────────────────────────────┐
│                        每日上午9:00触发                          │
└─────────────────────────────┬───────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  Phase 1: 数据收集（并行执行）                                   │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐               │
│  │  Data Agent │ │  News Agent │ │Twitter Agent│               │
│  │  汇率/金价   │ │  财经新闻    │ │  推特Trend  │               │
│  └─────────────┘ └─────────────┘ └─────────────┘               │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐               │
│  │HotSearch    │ │ Gaming Agent│ │  Music Agent│               │
│  │  热搜榜      │ │  游戏新闻    │ │  每日一曲   │               │
│  └─────────────┘ └─────────────┘ └─────────────┘               │
│  ┌─────────────┐                                               │
│  │ Vocab Agent │                                               │
│  │  行业词汇    │                                               │
│  └─────────────┘                                               │
└─────────────────────────────┬───────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  Phase 2: 数据整合                                              │
│  ┌─────────────────┐                                            │
│  │ Integrator Agent│                                            │
│  │  填充HTML模板    │                                            │
│  └─────────────────┘                                            │
└─────────────────────────────┬───────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  Phase 3: 发布与推送（并行执行）                                 │
│  ┌─────────────┐ ┌─────────────┐                               │
│  │ GitHub Agent│ │ Feishu Agent│                               │
│  │  上传仓库    │ │  发送通知    │                               │
│  └─────────────┘ └─────────────┘                               │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📑 各Agent详细职责

### 1. Template Agent
**职责**: 维护HTML模板
**输入**: 无
**输出**: `template.html`
**关键任务**:
- 确保模板包含所有占位符
- 维护CSS样式
- 确保移动端适配

### 2. Data Agent
**职责**: 获取实时汇率和金价
**输入**: 无
**输出**: JSON格式数据
```json
{
  "usd_cny": "7.2580",
  "usd_change": "+0.02%",
  "jpy_cny": "0.0478",
  "jpy_change": "-0.15%",
  "gold_rmb": "520.50",
  "gold_rmb_change": "+0.30%",
  "gold_london": "2895.00",
  "gold_london_change": "-0.52%"
}
```
**数据源**:
- 汇率: exchangerate-api.com, fixer.io, 或中国银行
- 金价: 上海黄金交易所, LBMA, 或金融数据API

### 3. News Agent
**职责**: 爬取财经新闻并进行事实核查
**输入**: 无
**输出**: 结构化新闻列表
**关键任务**:
- 爬取6大领域新闻
- 验证新闻时效性（排除过时新闻）
- 交叉验证多个来源
- 按重要性排序

**数据源**:
- 新浪财经、东方财富
- 华尔街见闻、财新网
- 各公司官方公告

### 4. Twitter Agent
**职责**: 获取美国和日本的推特Trend
**输入**: 无
**输出**: Trend列表
**关键任务**:
- 获取美国当日所有Trend
- 获取日本当日所有Trend
- 标注Trend热度

**数据源**:
- Twitter API v2
- 或爬虫（如使用爬虫需处理反爬）

### 5. HotSearch Agent
**职责**: 获取新浪或百度热搜
**输入**: 无
**输出**: 热搜榜单（Top 10-20）
**数据源**:
- 新浪热搜API/爬虫
- 百度热搜API/爬虫

### 6. Gaming Agent
**职责**: 收集游戏新闻
**输入**: 无
**输出**: 游戏新闻列表
**关键任务**:
- PC独立游戏动态
- Steam新品
- 手游/二游行业动态

**数据源**:
- Steam新闻
- 游戏媒体（如游民星空、3DM）
- 手游数据分析平台

### 7. Music Agent
**职责**: 推荐每日一曲
**输入**: 无
**输出**: 歌曲信息
```json
{
  "title": "歌曲名",
  "artist": "歌手",
  "genre": "曲风",
  "description": "背景介绍"
}
```
**优先级**: 日语/Vocaloid > EDM > 华语 > 小语种

### 8. Vocab Agent
**职责**: 整理5个行业英语词汇
**输入**: 当日新闻内容
**输出**: 词汇列表
```json
[
  {
    "word": "Distillation",
    "meaning": "蒸馏；此处指模型逆向工程攻击",
    "example": "Google disclosed that Gemini is under large-scale distillation attacks."
  }
]
```

### 9. Integrator Agent
**职责**: 整合所有数据到HTML模板
**输入**: 所有Agent的输出
**输出**: 完整的HTML文件
**关键任务**:
- 替换模板占位符
- 确保格式正确
- 生成日期命名文件（如 `2026-02-17.html`）

### 10. GitHub Agent
**职责**: 上传HTML到GitHub
**输入**: HTML文件
**输出**: GitHub提交
**要求**:
- 仓库: `Miraikuru/KimiClawPrj1StockData`
- Token: 用户提供
- 提交信息: "Add daily news report for YYYY-MM-DD"

### 11. Feishu Agent
**职责**: 通知用户
**输入**: 完成状态
**输出**: 飞书消息
**内容**: 
- 简报已生成
- GitHub链接
- 关键内容摘要

---

## ⏰ 执行时间表

| 时间 | 任务 |
|------|------|
| 08:50 | 系统唤醒，准备执行 |
| 09:00 | Phase 1开始：所有数据收集Agent并行启动 |
| 09:10 | Phase 1完成，数据汇总 |
| 09:12 | Phase 2开始：Integrator Agent填充模板 |
| 09:15 | Phase 2完成，生成HTML |
| 09:16 | Phase 3开始：GitHub上传、飞书推送并行 |
| 09:18 | 全部完成，用户收到通知 |

---

## 🛠️ 技术实现

### 子进程启动方式
使用 `sessions_spawn` 启动各Agent：

```javascript
// 示例：启动Data Agent
sessions_spawn({
  agentId: "data-agent",
  task: "获取今日USD/CNY和JPY/CNY汇率，以及金价数据...",
  label: "Data-Agent-2026-02-17"
})
```

### 数据传递
- 各Agent将结果写入共享目录
- 或使用消息机制传递
- Integrator Agent读取所有结果进行整合

### 错误处理
- 每个Agent独立运行，失败不影响其他Agent
- 设置超时机制（如5分钟）
- 失败时记录日志，使用默认值或跳过

---

## 📁 文件结构

```
daily-news/
├── requirements.md          # 需求文档
├── agent-swarm-workflow.md  # 本文件
├── template.html            # HTML模板
├── 2026-02-16.html          # 历史简报
├── 2026-02-17.html          # 今日简报
└── logs/                    # 执行日志
    ├── 2026-02-17/
    │   ├── data-agent.log
    │   ├── news-agent.log
    │   └── ...
```

---

## 🔧 待解决问题

1. **汇率API**: 需要确定具体使用哪个API（免费/付费）
2. **Twitter API**: 需要Twitter Developer账号和API Key
3. **新闻爬虫**: 需要处理反爬机制
4. **事实核查**: 需要设计自动核查机制

---

## 📝 变更记录

| 日期 | 版本 | 变更内容 |
|------|------|----------|
| 2026-02-17 | v1.0 | 初始版本 |
